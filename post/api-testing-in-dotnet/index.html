<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.25.1" />

  <title>API Testing In .NET with Expected.Request &middot; Wright Development</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://wright-development.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://wright-development.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://wright-development.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow-night-eighties.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://wright-development.github.io/img/favicon.ico" type="image/x-icon" />

  
  

  <style>
    pre {
        overflow: hidden !important;
    }    
</style>
<style>
    pre {
        overflow: hidden !important;
    }
    
    .comment-form {
        font: 95% Arial, Helvetica, sans-serif;
        max-width: 400px;
        margin: 10px auto;
        padding: 16px;
        background: #F7F7F7;
    }

    .comment-form h1 {
        background: #02A854;
        padding: 20px 0;
        font-size: 140%;
        font-weight: 300;
        text-align: center;
        color: #fff;
        margin: -16px -16px 16px -16px;
    }

    .comment-form input[type="text"],
    .comment-form input[type="date"],
    .comment-form input[type="datetime"],
    .comment-form input[type="email"],
    .comment-form input[type="number"],
    .comment-form input[type="search"],
    .comment-form input[type="time"],
    .comment-form input[type="url"],
    .comment-form textarea,
    .comment-form select {
        -webkit-transition: all 0.30s ease-in-out;
        -moz-transition: all 0.30s ease-in-out;
        -ms-transition: all 0.30s ease-in-out;
        -o-transition: all 0.30s ease-in-out;
        outline: none;
        box-sizing: border-box;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        width: 100%;
        background: #fff;
        margin-bottom: 4%;
        border: 1px solid #ccc;
        padding: 3%;
        color: #555;
        font: 95% Arial, Helvetica, sans-serif;
    }

    .comment-form input[type="text"]:focus,
    .comment-form input[type="date"]:focus,
    .comment-form input[type="datetime"]:focus,
    .comment-form input[type="email"]:focus,
    .comment-form input[type="number"]:focus,
    .comment-form input[type="search"]:focus,
    .comment-form input[type="time"]:focus,
    .comment-form input[type="url"]:focus,
    .comment-form textarea:focus,
    .comment-form select:focus {
        box-shadow: 0 0 5px #02A854;
        padding: 3%;
        border: 1px solid #02A854;
    }

    .comment-form button[type="submit"],
    .comment-form button[type="button"] {
        box-sizing: border-box;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        width: 100%;
        padding: 3%;
        background: #02A854;
        border-bottom: 2px solid #25B46B;
        border-top-style: none;
        border-right-style: none;
        border-left-style: none;
        color: #fff;
    }

    .comment-form button[type="submit"]:hover,
    .comment-form button[type="button"]:hover {
        background: #49C285;
    }

    .comment-form button[type="submit"]:disabled,
    .comment-form button[type="button"]:disabled {
        background: lightgrey;
        border-bottom: grey;
        
    }

</style>
<style>
     
@import url(//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css);
 
.comment-list .row {
background: #F7F7F7;
padding: 0px 25px;
padding-top: 5px;
padding-bottom: 15px;
margin: 25px 0;
}
.comment-list .panel .panel-heading {
padding: 4px 15px;
position: absolute;
border:none;
 
border-top-right-radius:0px;
top: 1px;
}
.comment-list .panel .panel-heading.right {
border-right-width: 0px;
 
border-top-left-radius:0px;
right: 16px;
}
.comment-list .panel .panel-heading .panel-body {
padding-top: 6px;
}
.comment-list figcaption {
 
word-wrap: break-word;
}
 
@media (min-width: 768px) {
.comment-list .arrow:after, .comment-list .arrow:before {
content: "";
position: absolute;
width: 0;
height: 0;
border-style: solid;
border-color: transparent;
}
.comment-list .panel.arrow.left:after, .comment-list .panel.arrow.left:before {
border-left: 0;
}
 
 
.comment-list .panel.arrow.left:before {
left: 0px;
top: 30px;
 
border-right-color: inherit;
border-width: 16px;
}
 
.comment-list .panel.arrow.left:after {
left: 1px;
top: 31px;
 
border-right-color: #FFFFFF;
border-width: 15px;
}
 
 
.comment-list .panel.arrow.right:before {
right: -16px;
top: 30px;
 
border-left-color: inherit;
border-width: 16px;
}
 
.comment-list .panel.arrow.right:after {
right: -14px;
top: 31px;
 
border-left-color: #FFFFFF;
border-width: 15px;
}
}
.comment-list .comment-post {
margin-top: 6px;
}
</style>

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://wright-development.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://wright-development.github.io/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://wright-development.github.io/Expected.Request/">Expected.Request</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/develop_wright" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/darrius-wright" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/wright-development" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>Wright Development &copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>API Testing In .NET with Expected.Request</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>05 October 2017</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://wright-development.github.io/tags/dotnet">dotnet</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://wright-development.github.io/tags/dotnet-core">dotnet core</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://wright-development.github.io/tags/api-testing">api testing</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://wright-development.github.io/tags/testing">testing</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://wright-development.github.io/tags/integration-testing">integration testing</a>
    
  </div>
  
  

</div>

  

<p>Alright, let&rsquo;s get started with the question that I&rsquo;m sure you are all asking, what is Expected.Request? Simply put it&rsquo;s a Fluent API I&rsquo;ve created to test REST APIs, and even better it&rsquo;s open source! Woot! Expected.Request abstracts away the HttpClient class in favor of clear and cohesive chaining. If you would like to see the full documentation for this package check that out <a href="https://wright-development.github.io/Expected.Request/">here</a>, otherwise let&rsquo;s jump into some examples.</p>

<p><strong>Coincidentally this post ties pretty well into my previous post about integration testing with docker in .NET, if you are interested check it out <a href="https://wright-development.github.io/post/using-docker-for-net-core/">here</a></strong></p>

<h2 id="project-setup">Project Setup</h2>

<p>In order to get started we will need an API to test against, and a test project. If you would like to avoid the setup feel free to download the starting project from <a href="https://github.com/wright-development/expected-request-sample-project/archive/start.zip">here</a>. Otherwise feel free to follow along with your own code.</p>

<p>Once you have downloaded the code, unzip and open the project in your favorite editor.</p>

<p><strong>If you are following along with your own code you will need to install Microsoft.AspNetCore.TestHost@2.0.0 (Optional, if you don&rsquo;t use this package then you will need to provide your own HttpClient, or allow Expected.Request to created it for you.), Newtonsoft.JSON@10.0.3 and Expected.Request@1.0.10</strong></p>

<h2 id="writing-tests">Writing Tests</h2>

<p>Alright now that the project is all set up, let&rsquo;s create a few tests and put Expected.Request to work. We&rsquo;ll start with a simple GET request on the ValuesController.</p>

<p>Without expected request, the code will look something like this&hellip;</p>

<pre><code class="language-csharp">private readonly TestServer _server;
private readonly HttpClient _client;
        
public ValuesControllerTests()
{
    _server = new TestServer(new WebHostBuilder()
        .UseStartup&lt;Startup&gt;());
    _client = _server.CreateClient();
}

[Fact]
public async Task http_client_test()
{
    var response = await _client.GetAsync(&quot;/api/values&quot;);

    var status = response.StatusCode;
    var content = await response.Content.ReadAsStringAsync();
    var contentObject = JsonConvert.DeserializeObject&lt;IEnumerable&lt;string&gt;&gt;(content);

    Assert.Equal(status, HttpStatusCode.OK);
    Assert.Equal(contentObject.ElementAt(0), &quot;value1&quot;);
    Assert.Equal(contentObject.ElementAt(0), &quot;values&quot;);
}
</code></pre>

<p>While this code isn&rsquo;t bad, it&rsquo;s easy to see that after a few tests there will be a lot of code duplication. In addition, the code could stand to be clearer, thus enters Expected.Request.</p>

<pre><code class="language-csharp">private readonly TestServer _server;
private readonly HttpClient _client;
        
public ValuesControllerTests()
{
    _server = new TestServer(new WebHostBuilder()
        .UseStartup&lt;Startup&gt;());
    _client = _server.CreateClient();
}

[Fact]
public async Task expected_request_test()
{
    await new Request(_client)
     .Get(&quot;/api/values&quot;)
     .Next(x =&gt; x.ExpectOk())
     .Next(x =&gt; x.Expect&lt;IEnumerable&lt;string&gt;&gt;((reponse) =&gt; {
         Assert.Equal(reponse.ElementAt(0), &quot;value1&quot;);
         Assert.Equal(reponse.ElementAt(1), &quot;value2&quot;);
     }))
     .Done();
}
</code></pre>

<p>With the syntax of Expected.Request, we can now read our API test with ease.</p>

<ul>
<li>Start a new Request</li>
<li>Perform a Get to the URL &lsquo;/api/values&rsquo;</li>
<li>Next, expect the status to be ok</li>
<li>Next, check the content matches my expectations</li>
<li>Done with the Request</li>
</ul>

<p>Expected Request shines even more when you want to perform multiple requests, for example after a POST to an API I want to perform a GET to retrieve the object back that I posted.</p>

<pre><code class="language-csharp">[Fact]
public async Task expected_request_multiple_requests_test()
{
    int id = 0;

    await new Request(_client)
     .Post(&quot;/api/values&quot;, &quot;value&quot;)
     .Next(x =&gt; x.ExpectOk())
     .Next(x =&gt; x.Map&lt;int&gt;(model =&gt; id = model))
     .Next(x =&gt; x.Get($&quot;/api/values/{id}&quot;, _client))
     .Next(x =&gt; x.ExpectContent(&quot;value&quot;))
     .Done();
}
</code></pre>

<p>Thank you for your time, and consider using <a href="https://wright-development.github.io/Expected.Request">Expected.Request</a> in your next project.</p>


  <h3>Comments</h3>




<section class="comment-list">

         

</section>


  <p>Hey, be the first to comment on this article.</p>

  <script>
  function getFormObj(formId) {
    var formObj = {};
    var inputs = $('#'+formId).serializeArray();
    $.each(inputs, function (i, input) {
        formObj[input.name] = input.value;
    });
    return formObj;
}

  sendRequest = function(url) {
    $('#comment-form-submit').prop("disabled", true)
    $.post(url, $('#comment-form').serialize(), ()=>{
      $('#comment-form-submit').prop("disabled", false)
      
      location.reload();
    });
  }
</script>

<form id="comment-form" class="comment-form" method="post" onsubmit="sendRequest('https://api.staticman.net/v2/entry/wright-development/wright-development.github.io/master/comments')">
  <label for="comment-form-name">Name</label>
  <input type="text" id="comment-form-name" name="fields[name]" tabindex="2" />
  <label for="comment-form-email">Email address</label>
  <input type="email" id="comment-form-email" name="fields[email]" tabindex="3" />
  <label for="comment-form-location" style="display:none;">Not used. Leave blank if you are a human.</label>
  <input type="text" id="comment-form-location" style="display:none;" name="fields[hidden]" autocomplete="off" />
  <label for="comment-form-message">Comment</label>
  <textarea type="text" rows="3" id="comment-form-message" name="fields[message]" tabindex="1"></textarea>
  <input type="hidden" name="options[entryId]" value="6ed078dc523e153c01211f94046bf6ff">
  <button type="submit" id="comment-form-submit" tabindex="5">Submit Comment</button>
</form>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://wright-development.github.io/post/using-docker-for-net-core/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://wright-development.github.io/post/using-docker-for-net-core/">Using Docker for .NET Core Integration Testing</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://wright-development.github.io/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61721549-2', 'auto');
  ga('send', 'pageview');

</script>



</body>
</html>

